<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css.css">
    <link rel="stylesheet" href="responsive.css">
    <link rel="stylesheet" href="fonts.css">

    <script src="https://kit.fontawesome.com/a1fc6f0f3a.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="msapplication-config" content="favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <title>plusUI</title>
</head>

<body>
    <div class="nonView"></div>

    <div class="keys">
        <div class="keyLines">
            <input class="keyTB" type="text" placeholder="OWM API Key" name="" id="owmAPI">
            <input class="keyTB" type="text" placeholder="City ID" name="" id="owmCity">
            <button class="keyTB submit" onclick="submitKeys()">Submit</button>
        </div>
    </div>

    <div class="tvUI" id="tvUI">
        <!-- <div class="nonView nv2"></div> -->

        <div class="backDrop" id="backDrop"></div>
        <div class="backDrop hidden" id="backDrop2"></div>

        <div class="cards darkModeOn" id="cards">
            <div class="wallCard card active" id="wallCard">
                <div class="info">
                    <!-- <div class="wallName">Name</div> -->
                    <!-- <div class="wallAuth">Author</div> -->
                </div>
            </div>
            <div class="weatherCard card" id="weatherCard">
                <img src="" alt="" id="weatherIcon">
                <div class="tdm temp" id="temp"></div>
            </div>
            <div class="batteryCard card" id="batteryCard">
                <div class="bcIndicator">
                    <i class="fa-solid fa-bolt chargingIcon"></i>
                    <div class="bciProg"></div>
                </div>
                <div class="batteryText"></div>
            </div>
            <div class="clockCard card" id="clockCard">
                <div id="clockContainer">
                    <div id="hour"></div>
                    <div id="minute"></div>
                    <div id="second"></div>
                </div>
            </div>
            <div class="photosCard card" id="photosCard">
                ❤️
            </div>
        </div>

        <div class="timeDate darkModeOn">
            <i id="clockIcon" class="fa-solid fa-clock"></i>
            <div class="td">
                <div class="tdm time" id="time"></div>
                <div class="tdm date" id="date"></div>
            </div>

            <div class="controlBtns">
                <div class="toggles">
                    <div class="lightDark btnCont">
                        <div class="button darkModeBtn darkModeOn" data-btnLabel="Theme">
                            <i class="fa-solid fa-circle-half-stroke"></i>
                        </div>
                    </div>
                    <div class="fullScreen btnCont">
                        <div class="button fullScreenBtn" data-btnLabel="Expand">
                            <i class="fa-solid fa-expand"></i>
                        </div>
                    </div>
                    <div class="reloadPage btnCont">
                        <div class="button reloadBtn" data-btnLabel="Refresh">
                            <i class="fa-solid fa-refresh"></i>
                        </div>
                    </div>
                </div>
                <div class="inputs">
                    <input class="keyTB" type="text" placeholder="Unsplash filters" name="" id="unsplashTags">
                    <input class="keyTB" type="number" value="1" min=".8" max="3" step=".01"
                        placeholder="Zoom level (1 is default)" id="zoomLvl">

                </div>
            </div>

            <div class="expandToggle">
                <i class="fa-solid fa-chevron-down"></i>
            </div>
        </div>
    </div>

    <script>
        var wallFilter = localStorage.getItem('unsplashTags');
        var backdropImg = 'https://source.unsplash.com/featured/?sig=' + Math.random() + wallFilter;

        window.onload = function () {
            showTime();
            showDate();

            $('#backDrop').css('background-image', "url(" + backdropImg + ")");
            $('#backDrop2').css('background-image', "url(" + backdropImg + ")");
            $('body').css('background-image', "url(" + backdropImg + ")");
            refreshWall();
            setInterval("refreshWall();", 30000);

            setTimeout("cardSmarts();", 500);

            applyKeys();

            checkTheme();
            doTheBatteryThing();
            chargingIndic();
        }

        var lsOwmAPI = localStorage.getItem('owmAPI');
        var lsOwmCity = localStorage.getItem('owmCity');

        function submitKeys() {
            localStorage.setItem('owmAPI', $('#owmAPI').val());
            localStorage.setItem('owmCity', $('#owmCity').val());
            window.location.reload();
            // alert(lsOwmAPI + " " + lsOwmCity + " " + lsrssapp);
        }

        function applyKeys() {
            if (localStorage.getItem('owmAPI') == null) {
                $('.keys').css('display', 'flex');
                alert('The info below is required to enter.');
            } else if (localStorage.getItem('owmCity') == null) {
                $('.keys').css('display', 'flex');
                alert('The info below is required to enter.');
            } else {
                var lsOwmAPI = localStorage.getItem('owmAPI');
                var lsOwmCity = localStorage.getItem('owmCity');

                $('.keys').css('display', 'none');
                $('.tvUI').css('display', 'flex');

                console.log('Keys loaded sucessfully.');

                weatherBalloon(lsOwmCity);
                window.setInterval("weatherBalloon(lsOwmCity);", 10000);
            }
        }

        var theme = true;
        var themeLS = localStorage.getItem('theme');

        $('.lightDark').on('click', function () {
            localStorage.setItem('theme', theme);
            $('.button').toggleClass('darkModeOn');
            $('.timeDate').toggleClass('darkModeOn');
            $('#cards').toggleClass('darkModeOn');
            theme = !theme;
        });

        $('.fullScreenBtn').on('click', function () {
            if ($('.tvUI').hasClass('tvFS')) {
                $('.tvUI').removeClass('tvFS');
            } else {
                $('.tvUI').addClass('tvFS');
            }
        });

        $('.reloadBtn').on('click', function () {
            window.location.reload();
        });

        $('.expandToggle').on('click', function () {
            $('.timeDate').toggleClass('expanded');
            $('.expandToggle').toggleClass('expanded');
        });

        $('#unsplashTags').focusout(function () {
            localStorage.setItem('unsplashTags', '&' + $(this).val());
            refreshWall();
        });

        $('#zoomLvl').change(function () {
            $('.tvUI').css('transform', 'scale(' + $(this).val() + ')')
        });

        setInterval(() => {
            d = new Date(); //object of date()
            hr = d.getHours();
            min = d.getMinutes();
            sec = d.getSeconds();
            hr_rotation = 30 * hr + min / 2; //converting current time
            min_rotation = 6 * min;
            sec_rotation = 6 * sec;

            hour.style.transform = `rotate(${hr_rotation}deg)`;
            minute.style.transform = `rotate(${min_rotation}deg)`;
            second.style.transform = `rotate(${sec_rotation}deg)`;
        }, 1000);

        var battery = navigator.battery || navigator.webkitBattery || navigator.mozBattery || navigator.msBattery;

        function doTheBatteryThing() {
            navigator.getBattery().then(function (battery) {
                var bLevPerc = (battery.level * 100) + "%";
                var bLev = battery.level * 100;
                var batteryIsCharging = battery.charging;
                battery.addEventListener('levelchange', function () {
                    $('.bciProg').css('width', bLevPerc);
                    $('.batteryText').text(Math.round(bLev) + "%");
                    $('.batteryText').attr('data-battLvl', Math.round(bLev));
                });
                $('.bciProg').css('width', bLevPerc);
                $('.batteryText').text(Math.round(bLev) + "%");
                $('.batteryText').attr('data-battLvl', Math.round(bLev));
            });
        }

        function chargingIndic() {
            let batteryIsCharging = false;

            navigator.getBattery().then(function (battery) {
                batteryIsCharging = battery.charging;
                if (batteryIsCharging == true) {
                    $('.chargingIcon').css('color', "#3daa39");
                } else {
                    $('.chargingIcon').css('color', "transparent");
                }

                battery.addEventListener('chargingchange', function () {
                    batteryIsCharging = battery.charging;
                    if (batteryIsCharging == true) {
                        $('.chargingIcon').css('color', "#3daa39");
                    } else {
                        $('.chargingIcon').css('color', "transparent");
                    }
                });
            });
        }

        function cardSmarts() {
            // the below will hide the battery card if the host device doesn't have a battery
            if ($('.batteryText').width() == "0") {
                $('.batteryCard').hide();
            } else {
                $('.batteryCard').show();
            }

            // this will slim the card to a square when device is charged. this can be removed if desired.
            var pp = $('.batteryText').attr('data-battLvl');

            if (pp >= "97") {
                $('.batteryText').text("");
                $('.batteryCard').addClass('square');
                $('.bciProg').css('width', "100%");
            } else {
                doTheBatteryThing();
            }
        }

        function checkTheme() {
            if (themeLS == 'false') {
                $('.button').addClass('darkModeOn');
                $('.timeDate').addClass('darkModeOn');
                $('#cards').addClass('darkModeOn');
            } else if (themeLS == 'true') {
                $('.button').removeClass('darkModeOn');
                $('.timeDate').removeClass('darkModeOn');
                $('#cards').removeClass('darkModeOn');
            }
        }

        $('.wallCard').on('click', function () {
            refreshWall();
        });

        function refreshWall() {
            var wallFilter = localStorage.getItem('unsplashTags');
            fetch("https://source.unsplash.com/random/?sig=" + Math.round(Math.random) + wallFilter).then(data => {
                var backdropSample = data.url;

                $('#backDrop').css('background-image', $('#backDrop2').css('background-image'));
                $('body').css('background-image', $('#backDrop2').css('background-image'));
                $('.nv2').css('background-image', $('#backDrop2').css('background-image'));
                $('.wallCard').css('background-image', $('#backDrop2').css('background-image'));
                $('#backDrop2').delay(700).css('background-image', "url(" + backdropSample + ")");
            });
        }

        function showTime() {
            var date = new Date();
            var h = date.getHours(); // 0 - 23
            var m = date.getMinutes(); // 0 - 59

            if (h == 0) {
                h = 12;
            }

            if (h > 12) {
                h = h - 12;
            }

            m = (m < 10) ? "0" + m : m;

            var time = h + ":" + m;
            document.getElementById("time").innerText = time;

            setTimeout(showTime, 1000);
        }

        function showDate() {
            const localDate = new Date();
            const months = [
                "January",
                "February",
                "March",
                "April",
                "May",
                "June",
                "July",
                "August",
                "September",
                "October",
                "November",
                "December",
            ];

            const days = [
                "Sunday",
                "Monday",
                "Tuesday",
                "Wednesday",
                "Thursday",
                "Friday",
                "Saturday",
            ];

            const currentDay = days[localDate.getDay()];
            const currentDate = localDate.getDate();
            const currentMonth = months[localDate.getMonth()];
            const currentYear = localDate.getFullYear();
            document.getElementById('date').innerText = currentDay + ", " + currentMonth + " " + currentDate;
        }

        function weatherBalloon(cityID) {
            var key = localStorage.getItem('owmAPI');
            fetch('https://api.openweathermap.org/data/2.5/weather?id=' + cityID + '&appid=' + key)
                .then(function (resp) { return resp.json() }) // Convert data to json
                .then(function (data) {

                    setTimeout(drawWeather(data), 10000);

                })
        }

        function drawWeather(d) {
            var fahrenheit = Math.round(((parseFloat(d.main.temp) - 273.15) * 1.8) + 32);
            document.getElementById('temp').innerText = fahrenheit + '°';
            var wIcon = d.weather[0].icon;
            $('#weatherIcon').attr('src', "http://openweathermap.org/img/wn/" + wIcon + "@4x.png");
        }
    </script>
</body>

</html>